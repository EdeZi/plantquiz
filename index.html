<!doctype html>
const g = strip(pedInput.value.trim()); if(!g) return;
const tgt = strip(pedCurrent.target);
const ok = g===tgt;
const li=document.createElement('li'); li.className='result-item';
li.innerHTML = `<div class="num ${ok?'ok':'ko'}">${pedGuesses.children.length+1}</div><div><b>${pedInput.value}</b><div class="muted">${ok?'‚úÖ Correct':'‚ùå Incorrect'}</div></div>`;
pedGuesses.prepend(li);
if(ok){ pedScore.hidden=false; pedScore.textContent = `Bravo ! Mot: ${pedCurrent.target}`; }
pedInput.value='';
}
function pedRevealMore(){
if(!pedCurrent) return; const total=(pedCurrent.sentences||[]).length; if(pedShownSentences<total){ pedShownSentences++; renderPedantix(); }
}


// R√âSULTATS
function showResults(){ const total=history.length, ok=history.filter(h=>h.ok).length, pct=Math.round(ok/Math.max(1,total)*100); const line=`Session : ${ok}/${total} (${pct}%) ‚Äî Elo : ${Math.round(elo)} ‚Äî Niveau : ${level}`; $('scoreLine').textContent=line; const list=$('resultsList'); list.innerHTML=''; history.forEach((h,i)=>{ const li=document.createElement('li'); li.className='result-item'; li.innerHTML=`<div class="num ${h.ok?'ok':'ko'}">${i+1}</div><div><div style="font-weight:700">${h.prompt}</div><div class="muted">Votre r√©ponse : <b>${h.picked}</b></div><div class="muted">Bonne r√©ponse : <b>${h.correctText}</b></div>${h.explanation?`<div style=\"margin-top:6px\">üí° ${h.explanation}</div>`:''}</div>`; list.appendChild(li); }); show(resultsSec); updateMeta(); }


// NAVIGATION
function goHome(){ mode='Accueil'; updateMeta(); show(homeSec); }
$('logo').addEventListener('click', goHome); $('homeBtn').addEventListener('click', goHome);


startNormalBtn.addEventListener('click', ()=>{ resetSession(); mode='Normal'; updateMeta(); show(quizSec); renderChoiceQuestion(); });
nextBtn.addEventListener('click', handleNextChoice); finishBtn.addEventListener('click', showResults);


startRevisionBtn.addEventListener('click', ()=>{ mode='R√©vision'; updateMeta(); fillMasters(); show(revSelectSec); });
selMaster.addEventListener('change', fillSemesters); selSem.addEventListener('change', fillUELists);
revBack.addEventListener('click', goHome);
revLaunch.addEventListener('click', ()=>{ const SET=buildRevisionSet(); if(!SET.length) return; const saved=QUESTIONS; resetSession(); QUESTIONS=SET; show(quizSec); renderChoiceQuestion(); finishBtn.onclick=()=>{ showResults(); QUESTIONS=saved; }; nextBtn.onclick=handleNextChoice; });


startPedBtn.addEventListener('click', ()=>{ mode='P√©dantix'; updateMeta(); pickPedantix(); show(pedSec); });
pedInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ pedCheckGuess(); }});
pedNew.addEventListener('click', ()=>{ pickPedantix(); });
pedReveal.addEventListener('click', ()=>{ pedRevealMore(); });


// DEMO FALLBACKS si /data/ absent
const DEMO_QUESTIONS=[{id:'L1Q1',level:1,prompt:'Quelle partie r√©alise la photosynth√®se ?',choices:[{id:'a',text:'Racines'},{id:'b',text:'Feuilles',correct:true},{id:'c',text:'Fleurs'},{id:'d',text:'Graines'}],explanation:'Les feuilles contiennent des chloroplastes.'}];
const DEMO_REV_INDEX={masters:[{key:'BIPA',label:'BIPA (d√©mo)',semesters:[{sem:'S7',core:[{id:'biostat_R',label:'Biostatistiques avec R'}],options:[{id:'opt_demo',label:'Option d√©mo'}]}]}]};
const DEMO_PED=[{id:'P1',title:'Photosynth√®se (d√©mo)',target:'chloroplaste',sentences:[
"Le CHAMP s'effectue dans les organites sp√©cialis√©s des cellules v√©g√©tales.",
"Chaque CHAMP contient des thylako√Ødes dispos√©s en grana.",
"La chlorophylle est localis√©e dans le CHAMP.",
"Le cycle de Calvin s'y d√©roule dans le stroma du CHAMP."
]}];


initData(); updateMeta();
</script>
</body>
</html>
